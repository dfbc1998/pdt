<!-- src/app/features/dashboard/client-dashboard/client-dashboard.component.html -->
<app-header title="Dashboard Cliente"></app-header>

<ion-content class="ion-padding">
  <div class="dashboard-container">
    @if (isLoading$ | async) {
    <app-loading message="Cargando dashboard..."></app-loading>
    } @else {
    <!-- Welcome Section -->
    @if (currentUser$ | async; as user) {
    <div class="welcome-section">
      <h1 class="welcome-title">
        ¡Bienvenido de nuevo, {{ user.displayName || 'Cliente' }}!
      </h1>
      <p class="welcome-subtitle">
        Gestiona tus proyectos y encuentra el mejor talento freelance
      </p>
    </div>
    }

    <!-- Quick Actions -->
    <ion-card class="quick-actions-card">
      <ion-card-header>
        <ion-card-title>Acciones Rápidas</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="actions-grid">
          <ion-button (click)="createProject()" expand="block" color="primary" class="action-button">
            <ion-icon name="add-outline" slot="start"></ion-icon>
            Crear Proyecto
          </ion-button>

          <ion-button (click)="viewProjects()" expand="block" fill="outline" class="action-button">
            <ion-icon name="folder-outline" slot="start"></ion-icon>
            Ver Proyectos
          </ion-button>

          <ion-button (click)="viewMessages()" expand="block" fill="outline" class="action-button">
            <ion-icon name="chatbubble-outline" slot="start"></ion-icon>
            Mensajes
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Statistics Cards -->
    <div class="stats-section">
      <h2 class="section-title">Resumen de Proyectos</h2>

      <ion-grid class="stats-grid">
        <ion-row>
          <ion-col size="12" size-sm="6" size-md="4">
            <ion-card class="stat-card total-projects">
              <ion-card-content>
                <div class="stat-content">
                  <ion-icon name="business-outline" class="stat-icon"></ion-icon>
                  <div class="stat-info">
                    <div class="stat-number">{{ stats.totalProjects }}</div>
                    <div class="stat-label">Total Proyectos</div>
                  </div>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>

          <ion-col size="12" size-sm="6" size-md="4">
            <ion-card class="stat-card published-projects">
              <ion-card-content>
                <div class="stat-content">
                  <ion-icon name="eye-outline" class="stat-icon"></ion-icon>
                  <div class="stat-info">
                    <div class="stat-number">{{ stats.publishedProjects }}</div>
                    <div class="stat-label">Publicados</div>
                  </div>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>

          <ion-col size="12" size-sm="6" size-md="4">
            <ion-card class="stat-card active-projects">
              <ion-card-content>
                <div class="stat-content">
                  <ion-icon name="time-outline" class="stat-icon"></ion-icon>
                  <div class="stat-info">
                    <div class="stat-number">{{ stats.activeProjects }}</div>
                    <div class="stat-label">En Progreso</div>
                  </div>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>

          <ion-col size="12" size-sm="6" size-md="4">
            <ion-card class="stat-card completed-projects">
              <ion-card-content>
                <div class="stat-content">
                  <ion-icon name="checkmark-circle-outline" class="stat-icon"></ion-icon>
                  <div class="stat-info">
                    <div class="stat-number">{{ stats.completedProjects }}</div>
                    <div class="stat-label">Completados</div>
                  </div>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>

          <ion-col size="12" size-sm="6" size-md="4">
            <ion-card class="stat-card draft-projects">
              <ion-card-content>
                <div class="stat-content">
                  <ion-icon name="pause-circle-outline" class="stat-icon"></ion-icon>
                  <div class="stat-info">
                    <div class="stat-number">{{ stats.draftProjects }}</div>
                    <div class="stat-label">Borradores</div>
                  </div>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>

          <ion-col size="12" size-sm="6" size-md="4">
            <ion-card class="stat-card freelancers">
              <ion-card-content>
                <div class="stat-content">
                  <ion-icon name="people-outline" class="stat-icon"></ion-icon>
                  <div class="stat-info">
                    <div class="stat-number">{{ stats.totalFreelancers }}</div>
                    <div class="stat-label">Freelancers</div>
                  </div>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

    <!-- Recent Projects -->
    <div class="recent-projects-section">
      <div class="section-header">
        <h2 class="section-title">Proyectos Recientes</h2>
        @if (allProjects.length > 5) {
        <ion-button (click)="viewAllProjects()" fill="clear" size="small" class="view-all-button">
          Ver todos
        </ion-button>
        }
      </div>

      @if (recentProjects.length === 0) {
      <ion-card class="empty-state">
        <ion-card-content>
          <div class="empty-content">
            <ion-icon name="folder-outline" class="empty-icon"></ion-icon>
            <h3>No tienes proyectos aún</h3>
            <p>Crea tu primer proyecto para comenzar a encontrar freelancers talentosos</p>
            <ion-button (click)="createProject()" color="primary">
              <ion-icon name="add-outline" slot="start"></ion-icon>
              Crear Primer Proyecto
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
      } @else {
      <ion-card class="projects-card">
        <ion-card-content class="projects-content">
          <ion-list class="projects-list">
            @for (project of recentProjects; track project.id) {
            <ion-item button (click)="viewProject(project.id)" class="project-item">
              <div class="project-content">
                <div class="project-header">
                  <h3 class="project-title">{{ project.title }}</h3>
                  <div class="project-meta">
                    <ion-badge [color]="getStatusColor(project.status)">
                      {{ getStatusText(project.status) }}
                    </ion-badge>
                  </div>
                </div>

                <p class="project-description">
                  {{ project.description.length > 120 ?
                  (project.description | slice:0:120) + '...' :
                  project.description }}
                </p>

                <div class="project-details">
                  <div class="detail-item">
                    <ion-icon name="cash" class="detail-icon"></ion-icon>
                    <span class="detail-text">{{ getBudgetText(project) }}</span>
                  </div>

                  <div class="detail-item">
                    <ion-icon name="calendar" class="detail-icon"></ion-icon>
                    <span class="detail-text">{{ formatDate(project.createdAt) }}</span>
                  </div>

                  <div class="detail-item">
                    <ion-icon name="people" class="detail-icon"></ion-icon>
                    <span class="detail-text">{{ project.proposalCount }} propuestas</span>
                  </div>
                </div>

                <div class="project-actions">
                  <ion-button fill="clear" size="small" (click)="viewProject(project.id); $event.stopPropagation()">
                    <ion-icon name="eye-outline" slot="start"></ion-icon>
                    Ver
                  </ion-button>

                  @if (project.status === 'draft') {
                  <ion-button fill="clear" size="small" color="tertiary"
                    (click)="editProject(project.id); $event.stopPropagation()">
                    <ion-icon name="create-outline" slot="start"></ion-icon>
                    Editar
                  </ion-button>
                  }
                </div>
              </div>
            </ion-item>
            }
          </ion-list>
        </ion-card-content>
      </ion-card>
      }
    </div>

    <!-- Refresh Button -->
    <div class="refresh-section">
      <ion-button (click)="refreshData()" fill="outline" expand="block" class="refresh-button">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Actualizar Datos
      </ion-button>
    </div>
    }
  </div>
</ion-content>